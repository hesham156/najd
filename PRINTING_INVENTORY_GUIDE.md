# 📦 دليل نظام إدارة مخزون الطباعة

<div dir="rtl">

**التاريخ**: 6 نوفمبر 2025  
**النظام**: إدارة المخزون للطباعة  
**الحالة**: ✅ جاهز للاستخدام

---

## 🎯 نظرة عامة:

نظام شامل لإدارة الخامات والأوراق والأحبار في قسم الطباعة:

✅ **إضافة وتتبع المخزون**  
✅ **تنبيهات عند نقص الكميات**  
✅ **طلب خامات من المدير**  
✅ **سجل كامل للحركات**

---

## 📋 الصفحات الجديدة:

### 1️⃣ صفحة إدارة المخزون:
```
/printing/inventory
```

### 2️⃣ صفحة طلبات الخامات:
```
/printing/material-requests
```

---

## 🚀 دليل الاستخدام السريع:

### **الخطوة 1: الدخول للمخزون**

```
1. سجل دخول كموظف طباعة
2. افتح http://localhost:3000/printing
3. اضغط زر "📦 إدارة المخزون" (أعلى اليمين)
```

---

### **الخطوة 2: إضافة مواد للمخزون**

```
1. اضغط "+ إضافة مادة" (أعلى اليسار)
2. املأ البيانات:

   ┌─────────────────────────────────┐
   │ نوع المادة: [ورق ▼]           │
   │ اسم المادة: ورق A4 أبيض 80جم  │
   │ الكمية الحالية: 100            │
   │ الوحدة: كجم                    │
   │ الحد الأدنى: 20 (تنبيه!)      │
   │ الحد الأقصى: 200               │
   │ موقع التخزين: رف A1            │
   │ المورد: مؤسسة الورق الفاخر     │
   │ وصف: ورق عالي الجودة...       │
   └─────────────────────────────────┘

3. اضغط "إضافة"
   ↓
✅ تم إضافة المادة بنجاح!
```

---

### **الخطوة 3: تحديث الكميات**

```
عند استخدام أو استلام خامات:

1. ابحث عن المادة في الجدول
2. اضغط "تعديل"
3. أدخل الكمية الجديدة:
   
   ┌──────────────────────────────┐
   │ الكمية الحالية: [45] كجم   │
   │ (السابقة: 50 كجم)          │
   │                              │
   │ ملاحظات (سبب التغيير):     │
   │ [استخدام في طلب #123]      │
   └──────────────────────────────┘

4. اضغط "تحديث"
   ↓
✅ تم تحديث الكمية: 50 → 45 كجم
✅ الحالة: متوفر ✅
✅ تم تسجيل الحركة
```

---

### **الخطوة 4: طلب خامات جديدة**

```
عندما تنفد أو تنقص الخامات:

1. اضغط "طلب خامات" (أعلى اليسار - برتقالي)
2. املأ المعلومات الأساسية:

   ┌──────────────────────────────────┐
   │ الأولوية: [عاجل ▼]             │
   │ سبب الطلب: نفاد الأحبار        │
   └──────────────────────────────────┘

3. اضغط "+ إضافة مادة"
4. اختر المادة:

   ┌──────────────────────────────────────┐
   │ اختر من المخزون:                   │
   │ [حبر أسود (2 لتر) ▼]               │
   │                                      │
   │ أو أدخل مادة جديدة:                │
   │ اسم المادة: [حبر أسود CMK]        │
   │ الكمية المطلوبة: [10] [لتر]       │
   │ التكلفة المقدرة: [500] ر.س        │
   └──────────────────────────────────────┘

5. أضف مواد أخرى (اختياري)
6. اضغط "إرسال طلب الخامات"
   ↓
✅ تم إرسال الطلب: MATREQ-2025-0001
✅ إشعار للمدير 📬
```

---

## 📊 واجهة المخزون:

### عند الدخول لأول مرة:

```
┌────────────────────────────────────────────────┐
│ مخزون الطباعة         [طلب خامات] [+ إضافة] │
├────────────────────────────────────────────────┤
│ ┌──────┐ ┌──────┐ ┌──────┐ ┌──────┐          │
│ │ 📦 0 │ │ ✅ 0 │ │ ⚠️ 0 │ │ ❌ 0 │          │
│ └──────┘ └──────┘ └──────┘ └──────┘          │
├────────────────────────────────────────────────┤
│ لا توجد مواد في المخزون                      │
│                                                │
│ [إضافة أول مادة]                              │
└────────────────────────────────────────────────┘
```

### بعد إضافة مواد:

```
┌────────────────────────────────────────────────────────────────┐
│ مخزون الطباعة                   [طلب خامات] [+ إضافة مادة]  │
├────────────────────────────────────────────────────────────────┤
│ ┌────────┐ ┌────────┐ ┌────────┐ ┌────────┐                  │
│ │ 📦     │ │ ✅     │ │ ⚠️     │ │ ❌     │                  │
│ │ 15     │ │ 10     │ │ 3      │ │ 2      │                  │
│ │ إجمالي │ │ متوفر  │ │ قليل   │ │ نفذ    │                  │
│ └────────┘ └────────┘ └────────┘ └────────┘                  │
├────────────────────────────────────────────────────────────────┤
│ المواد المتاحة:                                              │
│                                                                │
│ المادة              النوع    الكمية         الحالة    الموقع │
│ ───────────────────────────────────────────────────────────   │
│ ورق A4 80جم         ورق      100/20 كجم    ✅ متوفر   رف A1 │
│ ██████████████████████░░░░ 500%                      [تعديل]  │
│                                                                │
│ حبر أسود CMYK       أحبار    8/10 لتر      ⚠️ قليل   رف B2 │
│ ████████░░░░░░░░░░░░ 80%                             [تعديل]  │
│                                                                │
│ حبر أزرق           أحبار    0/10 لتر       ❌ نفذ    رف B2  │
│ ░░░░░░░░░░░░░░░░░░░░ 0%                              [تعديل]  │
│                                                                │
│ بليتات ألمنيوم     بليتات   3/5 قطعة      ⚠️ قليل   مخزن 1│
│ ██████░░░░░░░░░░░░░░ 60%                             [تعديل]  │
└────────────────────────────────────────────────────────────────┘
```

---

## 🔔 التنبيهات التلقائية:

### ⚠️ قليل (Low Stock):

```
عندما: الكمية <= الحد الأدنى
مثال: 8 لتر <= 10 لتر

يظهر:
- لون أصفر ⚠️
- Progress bar أصفر
- في الإحصائيات: "قليل: 3"
```

### ❌ نفذ (Out of Stock):

```
عندما: الكمية = 0

يظهر:
- لون أحمر ❌
- Progress bar فارغ
- في الإحصائيات: "نفذ: 2"
- في أول القائمة (ترتيب تلقائي)
```

---

## 📝 أمثلة عملية:

### مثال 1: إضافة ورق جديد

```
الموظف: أحمد (قسم الطباعة)

1. يفتح /printing/inventory
2. يضغط "+ إضافة مادة"
3. يختار:
   - النوع: ورق
   - الاسم: ورق A4 أبيض 80 جرام
   - الكمية: 100 كجم
   - الوحدة: كجم
   - الحد الأدنى: 20 كجم
   - الموقع: رف A1
   - المورد: مؤسسة الورق الفاخر
4. يضغط "إضافة"

النتيجة في Firestore:
{
  id: "auto_generated",
  category: "paper",
  name: "ورق A4 أبيض 80 جرام",
  quantity: 100,
  unit: "كجم",
  minQuantity: 20,
  status: "in_stock",  // ✅ محسوبة تلقائياً
  location: "رف A1",
  supplier: "مؤسسة الورق الفاخر",
  createdBy: "user_id",
  createdByName: "أحمد",
  department: "printing",
  createdAt: timestamp,
  updatedAt: timestamp
}
```

### مثال 2: استخدام حبر في طلب

```
الموظف: أحمد

1. يبدأ طباعة طلب #456
2. يستخدم 5 لتر حبر أسود
3. يفتح /printing/inventory
4. يضغط "تعديل" على "حبر أسود"
5. يغيّر: 15 → 10 لتر
6. يكتب: "استخدام في طلب #456"
7. يضغط "تحديث"

النتيجة:
✅ Inventory محدث:
   quantity: 15 → 10
   status: in_stock → in_stock (لازال فوق الحد)

✅ Transaction مُسجلة:
   {
     type: "out",  // استخدام
     quantity: 5,
     previousQuantity: 15,
     newQuantity: 10,
     reason: "استخدام في طلب #456",
     relatedOrderId: "456",
     performedBy: "user_id",
     performedByName: "أحمد"
   }
```

### مثال 3: طلب خامات ناقصة

```
الموظف: أحمد

الوضع:
- حبر أزرق: 3 لتر (الحد الأدنى: 10) ⚠️
- بليتات: 0 قطعة ❌

الإجراء:
1. يفتح /printing/inventory
2. يضغط "طلب خامات"
3. يختار الأولوية: عاجل
4. السبب: "نفاد بعض الخامات - طلبات كثيرة قادمة"
5. يضغط "+ إضافة مادة" مرتين

المادة #1:
   - اختر من المخزون: حبر أزرق
   - الكمية المطلوبة: 20 لتر
   - التكلفة المقدرة: 1000 ر.س

المادة #2:
   - اختر: -- مادة جديدة --
   - الاسم: بليتات ألمنيوم 0.3 مم
   - الكمية: 10 قطعة
   - الوحدة: قطعة
   - التكلفة: 500 ر.س

6. ملاحظات: "عاجل - لدينا 3 طلبات كبيرة الأسبوع القادم"
7. يضغط "إرسال طلب الخامات"

النتيجة في Firestore:
{
  id: "auto_generated",
  requestNumber: "MATREQ-2025-0001",
  status: "pending",
  items: [
    {
      id: "item1",
      inventoryItemId: "inv_xyz",  // ربط بالمخزون
      category: "ink",
      name: "حبر أزرق",
      requestedQuantity: 20,
      unit: "لتر",
      estimatedCost: 1000
    },
    {
      id: "item2",
      category: "plates",
      name: "بليتات ألمنيوم 0.3 مم",
      requestedQuantity: 10,
      unit: "قطعة",
      estimatedCost: 500
    }
  ],
  requestedBy: "user_id",
  requestedByName: "أحمد",
  department: "printing",
  priority: "urgent",
  reason: "نفاد بعض الخامات - طلبات كثيرة قادمة",
  notes: "عاجل - لدينا 3 طلبات كبيرة الأسبوع القادم",
  createdAt: timestamp,
  updatedAt: timestamp
}

إشعار للمدير:
{
  type: "material_request",
  title: "طلب خامات جديد 📦",
  message: "طلب خامات جديد من أحمد - MATREQ-2025-0001",
  recipientId: "printing_head_id",
  isActionRequired: true,
  actionUrl: "/printing/material-requests"
}
```

---

## 🎨 أمثلة المواد:

### 📄 ورق:

```
- ورق A4 أبيض 80 جرام
- ورق A3 ملون 100 جرام
- كرتون مقوى 300 جرام
- ورق فوتوغرافي لامع
```

### 🎨 أحبار:

```
- حبر أسود CMYK
- حبر أزرق Cyan
- حبر أحمر Magenta
- حبر أصفر Yellow
- حبر أبيض (للطباعة على الداكن)
```

### 📋 بليتات:

```
- بليتات ألمنيوم 0.3 مم
- بليتات بولي إستر
- بليتات حساسة للضوء
```

### 🔧 قوالب:

```
- قوالب قص A4
- قوالب ختم
- قوالب تشكيل
```

### ⚗️ كيماويات:

```
- محلول تنظيف البليتات
- محلول تثبيت
- مواد لاصقة
```

---

## 📊 الحالات والألوان:

### ✅ متوفر (In Stock):
```
الشرط: الكمية > الحد الأدنى
اللون: أخضر
المثال: 50 كجم (الحد الأدنى: 20)
Progress: ██████████████░░░░ (أخضر)
```

### ⚠️ قليل (Low Stock):
```
الشرط: 0 < الكمية <= الحد الأدنى
اللون: أصفر
المثال: 15 كجم (الحد الأدنى: 20)
Progress: ████████░░░░░░░░ (أصفر)
التنبيه: يجب طلب المزيد!
```

### ❌ نفذ (Out of Stock):
```
الشرط: الكمية = 0
اللون: أحمر
المثال: 0 كجم
Progress: ░░░░░░░░░░░░░░░░ (رمادي)
التنبيه: عاجل - اطلب الآن!
```

### 📦 تم الطلب (Ordered):
```
الشرط: تم رفع طلب خامات
اللون: أزرق
المعنى: في انتظار وصول الشحنة
```

---

## 🔍 متابعة الطلبات:

### في `/printing/material-requests`:

```
┌────────────────────────────────────────────┐
│ طلبات الخامات                             │
├────────────────────────────────────────────┤
│ [الكل (5)] [قيد الانتظار (2)] [موافق (1)]│
│ [مرفوض (1)] [تم الطلب (1)] [تم الاستلام] │
├────────────────────────────────────────────┤
│                                            │
│ ┌──────────────────────────────────────┐  │
│ │ MATREQ-2025-0001        [عاجل] [⏳] │  │
│ │ بواسطة: أحمد • 6 نوفمبر 2025       │  │
│ │ السبب: نفاد الأحبار                │  │
│ │ ────────────────────────────────────  │  │
│ │ المواد:                              │  │
│ │ • حبر أسود: 10 لتر (500 ر.س)      │  │
│ │ • بليتات: 5 قطعة (300 ر.س)        │  │
│ │ ────────────────────────────────────  │  │
│ │ الإجمالي: 800 ر.س                   │  │
│ └──────────────────────────────────────┘  │
│                                            │
│ (طلبات أخرى...)                           │
└────────────────────────────────────────────┘
```

---

## 🔐 الصلاحيات:

### موظف الطباعة:
```
✅ عرض المخزون (قسمه فقط)
✅ إضافة مواد
✅ تحديث الكميات
✅ طلب خامات جديدة
✅ عرض طلباته
❌ حذف مواد (رئيس القسم فقط)
❌ الموافقة على الطلبات (رئيس القسم)
```

### رئيس قسم الطباعة:
```
✅ كل صلاحيات الموظف
✅ حذف مواد
✅ الموافقة/رفض طلبات الخامات
✅ تحديث حالة الطلب (تم الطلب، تم الاستلام)
```

### CEO:
```
✅ عرض جميع المخزونات (كل الأقسام)
✅ كل الصلاحيات
```

---

## 📈 فوائد النظام:

### ✅ 1. تتبع دقيق:
- معرفة الكميات بالضبط
- معرفة متى تنفد المواد
- تخطيط أفضل للطلبات

### ✅ 2. تنبيهات مبكرة:
- إشعار عند نقص الكمية
- ألوان واضحة (أخضر/أصفر/أحمر)
- Progress bars مرئية

### ✅ 3. طلبات منظمة:
- أرقام فريدة لكل طلب
- تتبع الحالة
- سجل كامل

### ✅ 4. توفير التكاليف:
- تقدير تكلفة الطلب قبل الإرسال
- تجنب الطلب الزائد
- معرفة الاستهلاك

### ✅ 5. سجل شامل:
- كل حركة مُسجلة
- من استخدم، متى، لماذا
- ربط بطلبات الطباعة

---

## 🚀 الخطوات التالية:

### **الآن (أنت)**:

1. ✅ أعد تحميل المتصفح (F5)
2. ✅ افتح http://localhost:3000/printing
3. ✅ اضغط "📦 إدارة المخزون"
4. ✅ أضف بعض المواد للتجربة

### **لاحقاً (للمدير)**:

سأضيف:
- صفحة الموافقة على طلبات الخامات
- تحديث حالة الطلب (تم الطلب، تم الاستلام)
- تقارير المخزون
- تنبيهات تلقائية عند نقص الكميات

---

## 📚 الملفات المُضافة:

```
✅ packages/shared/src/types/inventory.types.ts
✅ apps/web/src/app/printing/inventory/page.tsx
✅ apps/web/src/app/printing/material-requests/page.tsx
✅ firestore.rules (تحديث - تم نشره)
```

---

## 🎉 النظام جاهز!

**✅ نظام إدارة المخزون مكتمل**  
**✅ Security Rules منشورة**  
**✅ واجهة مستخدم جاهزة**  
**✅ جاهز للاستخدام الفوري**

---

**🚀 جرب الآن:**

```
http://localhost:3000/printing
```

**ثم اضغط زر "📦 إدارة المخزون" البرتقالي!** ✨

</div>


