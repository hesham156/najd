# ๐ ุณูุฑ ุนูู ุทูุจุงุช ุนุฑูุถ ุงูุฃุณุนุงุฑ

## ๐ ูุธุฑุฉ ุนุงูุฉ

ูุฐุง ุงูููู ูุดุฑุญ ุณูุฑ ุงูุนูู ุงููุงูู ุนูุฏูุง ูุถูู **ุงููุจูุนุงุช** ุทูุจ ููุญุฏุฏู ูู **"ุทูุจ ุนุฑุถ ุณุนุฑ"** ูููู ูุตู ููุณู **ุงูุญุณุงุจุงุช** ูุฅูุดุงุก ุนุฑุถ ุงูุณุนุฑ.

---

## ๐ฏ ุงูุณูุฑ ุงููุงูู

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  1. ููุธู ุงููุจูุนุงุช: ุฅูุดุงุก ุทูุจ ุฌุฏูุฏ                              โ
โ     โ                                                            โ
โ  2. ุชุญุฏูุฏ "ุทูุจ ุนุฑุถ ุณุนุฑ" โ                                      โ
โ     โ                                                            โ
โ  3. ุงูุทูุจ ููุญูุธ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช                               โ
โ     isQuotation: true                                           โ
โ     status: pending_ceo_review                                  โ
โ     โ                                                            โ
โ  4. ูุณู ุงูุญุณุงุจุงุช ูุฑู ุงูุทูุจ ุชููุงุฆูุงู โ                          โ
โ     (ุจุณุจุจ isQuotation: true)                                   โ
โ     โ                                                            โ
โ  5. ูุณู ุงูุญุณุงุจุงุช ููุดุฆ ุนุฑุถ ุงูุณุนุฑ                                 โ
โ     โ                                                            โ
โ  6. ูุฑุงุฌุนุฉ ูููุงููุฉ ุฏุงุฎููุฉ                                       โ
โ     โ                                                            โ
โ  7. ุฅุฑุณุงู ุนุฑุถ ุงูุณุนุฑ ููุนููู                                      โ
โ     โ                                                            โ
โ  8. ุงูุชุธุงุฑ ุฑุฏ ุงูุนููู                                            โ
โ     โ                                                            โ
โ  9a. ุงูุนููู ูุงูู โ ุชุญููู ูุทูุจ ุชูููุฐ                            โ
โ  9b. ุงูุนููู ุฑูุถ โ ุฅุบูุงู ุงูุทูุจ                                  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ค ุงูุฎุทูุฉ 1: ููุธู ุงููุจูุนุงุช - ุฅูุดุงุก ุงูุทูุจ

### ุงููููุน:
```
http://localhost:3000/orders/new
```

### ุงูุฅุฌุฑุงุก:
1. ููุธู ุงููุจูุนุงุช ูููุฃ ูุนูููุงุช ุงูุนููู:
   - ุงุณู ุงูุนููู โ
   - ุฑูู ุงููุงุชู โ
   - ุงูุจุฑูุฏ ุงูุฅููุชุฑููู (ุงุฎุชูุงุฑู)
   - ุงูุนููุงู (ุงุฎุชูุงุฑู)

2. ูุถูู ุงูููุชุฌุงุช ุงููุทููุจุฉ:
   - ูุตู ุงูููุชุฌ
   - ููุน ุงูุทุจุงุนุฉ (ุฏูุฌูุชุงูุ ุฃููุณุชุ ุฅูุฏูุฑ)
   - ุงููููุฉ
   - ูู ูุญุชุงุฌ ุชุตูููุ

3. ูุถูู ูุนูููุงุช ุฅุถุงููุฉ:
   - ุงูุฃููููุฉ
   - ุชุงุฑูุฎ ุงูุชุณููู ุงููุทููุจ
   - ุงูููุงุฏ ุงููุทููุจุฉ (ุฅู ูุฌุฏุช)
   - ููุงุญุธุงุช

---

## โ ุงูุฎุทูุฉ 2: ุชุญุฏูุฏ "ุทูุจ ุนุฑุถ ุณุนุฑ"

### ูู ูุณู "ูุนูููุงุช ุฅุถุงููุฉ":

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  โ๏ธ ๐ฐ ุทูุจ ุนุฑุถ ุณุนุฑ (Quotation)                     โ
โ                                                     โ
โ  ุณูุชู ูุถุน ุนูุงูุฉ ุนูู ูุฐุง ุงูุทูุจ ูุทูุจ ุนุฑุถ ุณุนุฑ.      โ
โ  ูู ูุชู ุชูููุฐู ูุจุงุดุฑุฉ ุญุชู ุงูููุงููุฉ ุนูู ุงูุณุนุฑ      โ
โ  ูู ุงูุนููู.                                        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

**ุนูุฏ ุชูุนูู ูุฐุง ุงูู checkbox:**
- ุงูุทูุจ ููุญุฏุฏ ูุทูุจ ุนุฑุถ ุณุนุฑ
- ูุณู ุงูุญุณุงุจุงุช ุณูุฑุงู ุชููุงุฆูุงู
- ูุถุงู tag "quotation" ููุทูุจ

---

## ๐พ ุงูุฎุทูุฉ 3: ุญูุธ ุงูุทูุจ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

### ุงูุจูุงูุงุช ุงููุญููุธุฉ:

```typescript
{
  orderNumber: "NAJD-2025-0001",
  customerName: "ุดุฑูุฉ ุงูุฃูู",
  customerPhone: "+966501234567",
  status: "pending_ceo_review",
  
  // ุงูุชุญุฏูุฏ ุงูููู โ
  isQuotation: true,          // โ ูุฐุง ูุฌุนู ุงูุทูุจ ูุฑุฆู ููุณู ุงูุญุณุงุจุงุช
  tags: ["quotation"],        // โ ูุถุงู ุชููุงุฆูุงู
  
  // ... ุจุงูู ุงูุจูุงูุงุช
  products: [...],
  materials: [...],
  notes: "...",
  priority: "medium",
  createdBy: "sales_uid",
  createdByName: "ุฃุญูุฏ - ูุจูุนุงุช",
  createdAt: "2025-11-04T10:30:00Z"
}
```

---

## ๐๏ธ ุงูุฎุทูุฉ 4: ูุณู ุงูุญุณุงุจุงุช ูุฑู ุงูุทูุจ

### ููู ูุนููุ

ูู `firestore.rules`:

```javascript
(hasDepartment('accounting') && (
  resource.data.status in ['pending_payment', 'payment_confirmed'] ||
  // โ ูุณู ุงูุญุณุงุจุงุช ููููู ุฑุคูุฉ ุทูุจุงุช ุนุฑูุถ ุงูุฃุณุนุงุฑ ูู ุฃู ุญุงูุฉ
  resource.data.isQuotation == true
))
```

### ุงููุชูุฌุฉ:
โ ุนูุฏูุง ููุชุญ ููุธู ุงูุญุณุงุจุงุช ุตูุญุฉ ุงูุทูุจุงุชุ ุณูุฑู:
- ุฌููุน ุงูุทูุจุงุช ูู ุญุงูุฉ `pending_payment` ุฃู `payment_confirmed`
- **ุฌููุน ุงูุทูุจุงุช ุงูุชู `isQuotation: true`** (ูู ุฃู ุญุงูุฉ)

---

## ๐ฐ ุงูุฎุทูุฉ 5: ูุณู ุงูุญุณุงุจุงุช ููุดุฆ ุนุฑุถ ุงูุณุนุฑ

### ุงููููุน:
```
http://localhost:3000/accounting/quotations/new
```

### ุงููุนูููุงุช ุงููุทููุจุฉ:

1. **ูุนูููุงุช ุงูุนููู** (ุชููุณุฎ ูู ุงูุทูุจ):
   - ุงุณู ุงูุนููู
   - ุฑูู ุงููุงุชู
   - ุงูุจุฑูุฏ ุงูุฅููุชุฑููู
   - ุงุณู ุงูุดุฑูุฉ (ุฅู ูุฌุฏ)
   - ุงูุฑูู ุงูุถุฑูุจู (ุฅู ูุฌุฏ)

2. **ุจููุฏ ุนุฑุถ ุงูุณุนุฑ**:
   ```typescript
   {
     description: "ุทุจุงุนุฉ ูุฑูุช ุดุฎุตูุฉ",
     quantity: 1000,
     unitPrice: 0.50,
     totalPrice: 500.00
   }
   ```

3. **ุงูุญุณุงุจุงุช ุงููุงููุฉ**:
   - ุงููุฌููุน ุงููุฑุนู: 500 ุฑ.ุณ
   - ุงูุถุฑูุจุฉ (15%): 75 ุฑ.ุณ
   - ุงูุฎุตู (ุฅู ูุฌุฏ): 0 ุฑ.ุณ
   - **ุงููุฌููุน ุงูุฅุฌูุงูู: 575 ุฑ.ุณ**

4. **ุดุฑูุท ุงูุฏูุน**:
   - ุทุฑููุฉ ุงูุฏูุน: "ููุฏู ุฃู ุขุฌู 30 ููู"
   - ุงูุฏูุนุฉ ุงูููุฏูุฉ: 50%
   - ุชุงุฑูุฎ ุงูุงุณุชุญูุงู: "2025-12-15"

5. **ุชุงุฑูุฎ ุงูุตูุงุญูุฉ**:
   - ุนุฑุถ ุงูุณุนุฑ ุตุงูุญ ุญุชู: "2025-12-01"

### ุงูุญูุธ:

```typescript
{
  quotationNumber: "QT-2025-0001",
  relatedOrderId: "order_123",        // โ ุฑุจุท ูุน ุงูุทูุจ ุงูุฃุตูู
  relatedOrderNumber: "NAJD-2025-0001",
  
  customerName: "ุดุฑูุฉ ุงูุฃูู",
  items: [...],
  
  subtotal: 500,
  taxRate: 15,
  taxAmount: 75,
  totalAmount: 575,
  
  status: "quotation_draft",          // ุงูุจุฏุงูุฉ ููุณูุฏุฉ
  issueDate: "2025-11-04",
  validUntil: "2025-12-01",
  
  preparedBy: "accountant_uid",
  preparedByName: "ูุงุทูุฉ - ุญุณุงุจุงุช"
}
```

---

## โ ุงูุฎุทูุฉ 6: ูุฑุงุฌุนุฉ ูููุงููุฉ ุฏุงุฎููุฉ

### ุงูุณูุฑ:
1. ุงููุญุงุณุจ ููุชูู ูู ุฅุนุฏุงุฏ ุนุฑุถ ุงูุณุนุฑ
2. ูุทูุจ ุงูููุงููุฉ ูู ูุฏูุฑ ุงูุญุณุงุจุงุช
3. ูุฏูุฑ ุงูุญุณุงุจุงุช ูุฑุงุฌุน:
   - ุงูุฃุณุนุงุฑ ุตุญูุญุฉุ โ
   - ุงูุถุฑูุจุฉ ูุญุณูุจุฉ ุจุดูู ุตุญูุญุ โ
   - ุดุฑูุท ุงูุฏูุน ููุงุณุจุฉุ โ
4. ููุงูู ุนูู ุนุฑุถ ุงูุณุนุฑ

```typescript
{
  status: "quotation_approved",
  approvedBy: "accounting_head_uid",
  approvedByName: "ูุญูุฏ - ูุฏูุฑ ุงูุญุณุงุจุงุช",
  approvalDate: "2025-11-04T14:00:00Z"
}
```

---

## ๐ง ุงูุฎุทูุฉ 7: ุฅุฑุณุงู ุนุฑุถ ุงูุณุนุฑ ููุนููู

### ุงูุฅุฌุฑุงุก:
1. ุทุจุงุนุฉ ุนุฑุถ ุงูุณุนุฑ ุฃู ุชุตุฏูุฑู ูู PDF
2. ุฅุฑุณุงู ุนุจุฑ:
   - ุงูุจุฑูุฏ ุงูุฅููุชุฑููู โ๏ธ
   - WhatsApp ๐ฌ
   - ุชุณููู ูุฏูู ๐ค

3. ุชุณุฌูู ุงูุฅุฑุณุงู:

```typescript
{
  status: "quotation_sent",
  sentToClientAt: "2025-11-04T15:00:00Z",
  sentBy: "accountant_uid"
}
```

---

## โณ ุงูุฎุทูุฉ 8: ุงูุชุธุงุฑ ุฑุฏ ุงูุนููู

### ุญุงูุฉ ุนุฑุถ ุงูุณุนุฑ:
```
status: "quotation_client_reviewing"
```

### ุงููุชุงุจุนุฉ:
- ุจุนุฏ 3 ุฃูุงู: ุงุชุตุงู ูููุชุงุจุนุฉ โ๏ธ
- ูุจู ููู ูู ุงูุชูุงุก ุงูุตูุงุญูุฉ: ุชูุจูู โฐ

---

## โ ุงูุฎุทูุฉ 9ุฃ: ุงูุนููู ูุงูู

### ุงูุฅุฌุฑุงุก:

1. **ุชุณุฌูู ููุงููุฉ ุงูุนููู:**
```typescript
{
  status: "quotation_accepted",
  clientResponseDate: "2025-11-05T10:00:00Z",
  clientFeedback: "ููุงูู ุนูู ุงูุณุนุฑ"
}
```

2. **ุชุญููู ุนุฑุถ ุงูุณุนุฑ ูุทูุจ ุชูููุฐ:**

```typescript
// ุชุญุฏูุซ ุงูุทูุจ ุงูุฃุตูู
Order.update({
  isQuotation: false,              // โ ูู ูุนุฏ ุทูุจ ุนุฑุถ ุณุนุฑ
  quotationId: "quotation_123",
  quotationNumber: "QT-2025-0001",
  quotationApprovedAt: "2025-11-05T10:00:00Z",
  
  status: "pending_ceo_review",    // ูุจุฏุฃ ุงูุณูุฑ ุงูุทุจูุนู
  
  // ุงููุนูููุงุช ุงููุงููุฉ ูู ุนุฑุถ ุงูุณุนุฑ
  estimatedCost: 575,
  finalCost: 575
});

// ุชุญุฏูุซ ุนุฑุถ ุงูุณุนุฑ
Quotation.update({
  status: "quotation_converted",
  convertedToOrderAt: "2025-11-05T10:00:00Z",
  convertedToOrderId: "order_123"
});
```

3. **ุงูุทูุจ ูุฏุฎู ูู ุงูุณูุฑ ุงูุทุจูุนู:**
```
pending_ceo_review โ pending_design โ pending_printing โ 
pending_payment โ ready_for_dispatch โ delivered
```

---

## โ ุงูุฎุทูุฉ 9ุจ: ุงูุนููู ุฑูุถ

### ุงูุฅุฌุฑุงุก:

```typescript
// ุชุญุฏูุซ ุนุฑุถ ุงูุณุนุฑ
Quotation.update({
  status: "quotation_rejected",
  clientResponseDate: "2025-11-05T10:00:00Z",
  clientFeedback: "ุงูุณุนุฑ ูุฑุชูุน"
});

// ุชุญุฏูุซ ุงูุทูุจ ุงูุฃุตูู
Order.update({
  status: "cancelled",
  notes: "ุงูุนููู ุฑูุถ ุนุฑุถ ุงูุณุนุฑ - ุงูุณุนุฑ ูุฑุชูุน"
});
```

### ุงูุฎูุงุฑุงุช:
1. **ุฅุบูุงู ุงูุทูุจ** โ
2. **ุงูุชูุงูุถ ูุชุนุฏูู ุงูุณุนุฑ** ๐ฌ
   - ุชุบููุฑ ุงูุญุงูุฉ ูู `quotation_negotiating`
   - ุฅูุดุงุก ุนุฑุถ ุณุนุฑ ูุนุฏู
   - ุฅุนุงุฏุฉ ุงูุฅุฑุณุงู

---

## ๐ ููุฎุต ุงูุญุงูุงุช

### ุญุงูุงุช ุงูุทูุจ:

| ุงูุญุงูุฉ | ุงููุตู | ุงููุณู ุงููุณุคูู |
|--------|-------|---------------|
| `pending_ceo_review` | ูู ุงูุชุธุงุฑ ูุฑุงุฌุนุฉ ุงููุฏูุฑ | CEO |
| โ (ุจุนุฏ ููุงููุฉ ุงูุนููู) |
| `pending_design` | ูู ุงูุชุธุงุฑ ุงูุชุตููู | ุงูุชุตููู |
| `pending_printing` | ูู ุงูุชุธุงุฑ ุงูุทุจุงุนุฉ | ุงูุทุจุงุนุฉ |
| `pending_payment` | ูู ุงูุชุธุงุฑ ุงูุฏูุน | ุงูุญุณุงุจุงุช |
| `delivered` | ุชู ุงูุชุณููู | - |

### ุญุงูุงุช ุนุฑุถ ุงูุณุนุฑ:

| ุงูุญุงูุฉ | ุงููุตู |
|--------|-------|
| `quotation_draft` | ูุณูุฏุฉ |
| `quotation_pending_approval` | ูู ุงูุชุธุงุฑ ุงูููุงููุฉ ุงูุฏุงุฎููุฉ |
| `quotation_approved` | ุชูุช ุงูููุงููุฉ |
| `quotation_sent` | ุชู ุฅุฑุณุงูู ููุนููู |
| `quotation_client_reviewing` | ุงูุนููู ูุฑุงุฌุน |
| `quotation_accepted` | ุงูุนููู ูุงูู โ |
| `quotation_rejected` | ุงูุนููู ุฑูุถ โ |
| `quotation_negotiating` | ููุฏ ุงูุชูุงูุถ |
| `quotation_converted` | ุชู ุชุญูููู ูุทูุจ |

---

## ๐ฏ ุงูููุงุท ุงููููุฉ

### โ ูููุจูุนุงุช:
1. ุนูุฏ ุชุญุฏูุฏ "ุทูุจ ุนุฑุถ ุณุนุฑ"ุ ุงูุทูุจ ูุฐูุจ ูุจุงุดุฑุฉ ููุณู ุงูุญุณุงุจุงุช
2. **ูุง ุชุจุฏุฃ ุฃู ุชูููุฐ** ูุจู ููุงููุฉ ุงูุนููู ุนูู ุงูุณุนุฑ
3. ุฃุฏุฎู ูุนูููุงุช ุงูุนููู ุจุฏูุฉ (ุงุณู ุงูุดุฑูุฉุ ุงูุฑูู ุงูุถุฑูุจู ุฅู ูุฌุฏ)

### โ ููุณู ุงูุญุณุงุจุงุช:
1. ุงูุทูุจุงุช ุงูุชู `isQuotation: true` ุชุธูุฑ ูู ูุจุงุดุฑุฉ
2. ุฃูุดุฆ ุนุฑุถ ุงูุณุนุฑ ุจุฏูุฉ (ุงูุฃุณุนุงุฑุ ุงูุถุฑูุจุฉุ ุดุฑูุท ุงูุฏูุน)
3. ุงุทูุจ ุงูููุงููุฉ ุงูุฏุงุฎููุฉ ูุจู ุงูุฅุฑุณุงู ููุนููู
4. ุณุฌู ูู ุงุชุตุงู ูุน ุงูุนููู
5. ุจุนุฏ ููุงููุฉ ุงูุนูููุ ุญููู ุนุฑุถ ุงูุณุนุฑ ูุทูุจ ุชูููุฐ

### โ ูุฌููุน ุงูุฃูุณุงู:
- ุงูุทูุจุงุช ุงูุชู ููุง `isQuotation: true` **ูุง ุชูููุฐ** ุญุชู:
  1. ูุณู ุงูุญุณุงุจุงุช ููุดุฆ ุนุฑุถ ุงูุณุนุฑ
  2. ุงูุนููู ููุงูู
  3. ูุชู ุชุญููู ุงูุทูุจ (ุชุตุจุญ `isQuotation: false`)

---

## ๐ง ุงูุชุญุฏูุซุงุช ุงูุชูููุฉ

### ูู `firestore.rules`:

```javascript
// ูุณู ุงูุญุณุงุจุงุช ููููู ุฑุคูุฉ:
(hasDepartment('accounting') && (
  resource.data.status in ['pending_payment', 'payment_confirmed'] ||
  resource.data.isQuotation == true  // โ ุฌููุน ุทูุจุงุช ุนุฑูุถ ุงูุฃุณุนุงุฑ
))

// ูุณู ุงูุญุณุงุจุงุช ููููู ุชุญุฏูุซ:
(hasDepartment('accounting') && (
  resource.data.status in ['pending_payment'] ||
  resource.data.isQuotation == true  // โ ุฌููุน ุทูุจุงุช ุนุฑูุถ ุงูุฃุณุนุงุฑ
))
```

### ูู `orders/new/page.tsx`:

```typescript
// ุงูุณุทุฑ 65
const [isQuotation, setIsQuotation] = useState(false);

// ุงูุณุทุฑ 246
tags: isQuotation ? ['quotation'] : [],

// ุงูุณุทุฑ 248
isQuotation, // ุทูุจ ุนุฑุถ ุณุนุฑ
```

---

## ๐ ูููุงุช ุฐุงุช ุตูุฉ

| ุงูููู | ุงููุตู |
|------|-------|
| `ACCOUNTING_DEPARTMENT.md` | ุฏููู ูุณู ุงูุญุณุงุจุงุช ุงูุดุงูู |
| `QUOTATION_FEATURE.md` | ุดุฑุญ ููุฒุฉ ุนุฑูุถ ุงูุฃุณุนุงุฑ |
| `firestore.rules` | ููุงุนุฏ ุงูุฃูุงู ูุงูุตูุงุญูุงุช |
| `apps/web/src/app/orders/new/page.tsx` | ุตูุญุฉ ุฅูุดุงุก ุทูุจ ุฌุฏูุฏ |
| `apps/web/src/app/accounting/page.tsx` | ููุญุฉ ุชุญูู ูุณู ุงูุญุณุงุจุงุช |
| `packages/shared/src/types/quotation.types.ts` | ุฃููุงุน ุนุฑูุถ ุงูุฃุณุนุงุฑ |

---

## ๐ ุงูุจุฏุก ุงูุณุฑูุน

### 1. ุฅูุดุงุก ุทูุจ ุนุฑุถ ุณุนุฑ (ุงููุจูุนุงุช):
```
1. http://localhost:3000/orders/new
2. ุงููุฃ ูุนูููุงุช ุงูุนููู ูุงูููุชุฌุงุช
3. โ ูุนูู "ุทูุจ ุนุฑุถ ุณุนุฑ"
4. ุงุถุบุท "ุฅูุดุงุก ุงูุทูุจ"
```

### 2. ุฅูุดุงุก ุนุฑุถ ุงูุณุนุฑ (ุงูุญุณุงุจุงุช):
```
1. http://localhost:3000/accounting
2. ุงูุทูุจ ุณูุธูุฑ ูู ุงููุงุฆูุฉ
3. ุงูุชุญ ุงูุทูุจ
4. ุงุถุบุท "ุฅูุดุงุก ุนุฑุถ ุณุนุฑ"
5. ุงููุฃ ุงูุชูุงุตูู ูุงูุฃุณุนุงุฑ
6. ุงุญูุธ ูุงุทูุจ ุงูููุงููุฉ
```

### 3. ุฅุฑุณุงู ููุนููู:
```
1. ุจุนุฏ ุงูููุงููุฉ
2. ุทุจุงุนุฉ/ุชุตุฏูุฑ PDF
3. ุฅุฑุณุงู ููุนููู
4. ุณุฌู ุงูุฅุฑุณุงู
```

### 4. ุชุณุฌูู ุงูุฑุฏ:
```
1. ุฅุฐุง ูุงูู โ ุชุญููู ูุทูุจ
2. ุฅุฐุง ุฑูุถ โ ุฅุบูุงู ุฃู ุชูุงูุถ
```

---

ยฉ 2024 ุดุฑูุฉ ูุฌุฏ - ุฌููุน ุงูุญููู ูุญููุธุฉ


