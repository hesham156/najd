# ๐ง ุฅุตูุงุญ ุตูุงุญูุงุช ุงููุณุชุฎุฏููู - ูุธุงู ุงูุดุงุช

<div dir="rtl">

**ุงูุชุงุฑูุฎ**: 6 ููููุจุฑ 2025  
**ุงูุญุงูุฉ**: โ ุชู ุงูุฅุตูุงุญ

---

## โ๏ธ ุงููุดููุฉ ุงูุฃุตููุฉ:

```
Error fetching allowed users: FirebaseError: Missing or insufficient permissions.
```

### ุงูุณุจุจ:
Security Rules ุงูุฃุตููุฉ ููู `users` collection ูุงูุช:
```javascript
allow read: if isOwner(userId) || isCEO();
```

ูุฐุง ูุนูู:
- โ ุงููุณุชุฎุฏู ููููู ูุฑุงุกุฉ **ุจูุงูุงุชู ููุท**
- โ ุฃู ูุฌุจ ุฃู ูููู **CEO**

**ุงููุดููุฉ**: ูุธุงู ุงูุดุงุช ูุญุชุงุฌ ููุฑุงุกุฉ ูุงุฆูุฉ ุฌููุน ุงููุณุชุฎุฏููู ุงููุดุทูู ูุนุฑุถ ูู ูููู ุงูุชูุงุตู ูุนูู!

---

## โ ุงูุญู ุงููุทุจู:

### ุชุนุฏูู Security Rules:

**ูุจู**:
```javascript
match /users/{userId} {
  allow read: if isOwner(userId) || isCEO();
}
```

**ุจุนุฏ**:
```javascript
match /users/{userId} {
  // ุฃู ูุณุชุฎุฏู ูุดุท ููููู ูุฑุงุกุฉ ุจูุงูุงุช ุงููุณุชุฎุฏููู
  allow read: if isActiveUser();
}
```

### ููุงุฐุง ูุฐุง ุขููุ

1. โ **ููุท ุงููุณุชุฎุฏููู ุงููุดุทูู** (`isActive: true`) ูููููู ุงููุฑุงุกุฉ
2. โ ุงููุณุชุฎุฏููู ุบูุฑ ุงููุณุฌููู **ูุง ูููููู** ุงููุฑุงุกุฉ
3. โ ุงููุณุชุฎุฏููู ุงููุญุธูุฑูู (`isActive: false`) **ูุง ูููููู** ุงููุฑุงุกุฉ
4. โ ูุญุชุงุฌ ูุฐุง ููุดุงุช ูุฅุฏุงุฑุฉ ุงููุฑูู

### ูุง ูููู ูุฑุงุกุชู:
- ุงูุงุณู (`displayName`)
- ุงูุฏูุฑ (`role`)
- ุงููุณู (`department`)
- ูู ูู ุฑุฆูุณ ูุณู (`isHead`)
- ุญุงูุฉ ุงููุดุงุท (`isActive`)

ูุฐู ูุนูููุงุช ุฃุณุงุณูุฉ **ุบูุฑ ุญุณุงุณุฉ** ููุทููุจุฉ ููุดุงุช.

---

## ๐ ุงููุดุฑ:

ุชู ูุดุฑ ุงูุชุนุฏููุงุช ุจูุฌุงุญ:

```bash
firebase deploy --only firestore:rules
```

**ุงููุชูุฌุฉ**:
```
โ rules file compiled successfully
โ rules released to cloud.firestore
โ Deploy complete!
```

---

## โจ ุงููุธุงู ุงูุขู ูุนูู ุจุงููุงูู!

### ุงุฎุชุจุฑ ุงูุขู:

1. **ุงูุชุญ ุตูุญุฉ ุงูุดุงุช**:
   ```
   http://localhost:3000/chat
   ```

2. **ุงุถุบุท ุนูู ุฒุฑ "+" (ูุญุงุฏุซุฉ ุฌุฏูุฏุฉ)**

3. **ุณุชุธูุฑ ูุงุฆูุฉ ุงููุณุชุฎุฏููู ุงููุณููุญ ุงูุชูุงุตู ูุนูู** โ

4. **ุงุฎุชุฑ ูุณุชุฎุฏู ูุงุจุฏุฃ ุงููุญุงุฏุซุฉ** ๐ฌ

---

## ๐ ุงูุตูุงุญูุงุช ุงููุงููุฉ ุงูุขู:

### Users Collection:
```javascript
โ ุงููุฑุงุกุฉ: ุฃู ูุณุชุฎุฏู ูุดุท
โ ุงูุฅูุดุงุก: ุงููุณุชุฎุฏู ููุณู ุฃู CEO
โ ุงูุชุญุฏูุซ: ุงููุณุชุฎุฏู (ุจูุงูุงุช ุฃุณุงุณูุฉ) ุฃู CEO
โ ุงูุญุฐู: CEO ููุท
```

### Chats Collection:
```javascript
โ ุงููุฑุงุกุฉ: ุงููุดุงุฑููู ูู ุงููุญุงุฏุซุฉ ููุท
โ ุงูุฅูุดุงุก: ูุน ูุณุชุฎุฏููู ูุตุฑุญ ุจูู ููุท
โ ุงูุชุญุฏูุซ: ุงููุดุงุฑููู ููุท
โ ุงูุญุฐู: ููููุน
```

### Messages Subcollection:
```javascript
โ ุงููุฑุงุกุฉ: ุงููุดุงุฑููู ูู ุงููุญุงุฏุซุฉ
โ ุงูุฅูุดุงุก: ุงููุดุงุฑููู ููุท
โ ุงูุชุญุฏูุซ: ุงููุฑุณู ุฃู ูุชุญุฏูุซ ุญุงูุฉ ุงููุฑุงุกุฉ
โ ุงูุญุฐู: ุงููุฑุณู ููุท
```

---

## ๐ฏ ุงูุณููุงุฑูู ุงููุงูู:

### 1. ุงููุณุชุฎุฏู ููุชุญ ุตูุญุฉ ุงูุดุงุช:
```
โ ูุญููู ุฌููุน ูุญุงุฏุซุงุชู (ุงููุดุงุฑู ูููุง ููุท) โ
```

### 2. ุงููุณุชุฎุฏู ูุถุบุท "ูุญุงุฏุซุฉ ุฌุฏูุฏุฉ":
```
โ ูุฌูุจ ูุงุฆูุฉ ุฌููุน ุงููุณุชุฎุฏููู ุงููุดุทูู โ
โ ูุตููููุง ุญุณุจ ุงูููุงุนุฏ ุงููุฑููุฉ โ
โ ูุนุฑุถ ููุท ุงููุณุชุฎุฏููู ุงููุณููุญ ุงูุชูุงุตู ูุนูู โ
```

### 3. ุงููุณุชุฎุฏู ูุฎุชุงุฑ ูุณุชุฎุฏู:
```
โ ูุชุญูู ูู ุงูุตูุงุญูุงุช โ
โ ููุดุฆ ุงููุญุงุฏุซุฉ (ุฅุฐุง ูุงูุช ูุณููุญ ุจูุง) โ
โ ููุชุญ ุงููุญุงุฏุซุฉ โ
```

### 4. ุงููุณุชุฎุฏู ูุฑุณู ุฑุณุงูุฉ:
```
โ ูุชุญูู ุฃูู ูุดุงุฑู ูู ุงููุญุงุฏุซุฉ โ
โ ูุถูู ุงูุฑุณุงูุฉ โ
โ ูุญุฏุซ ุขุฎุฑ ุฑุณุงูุฉ ูู ุงููุญุงุฏุซุฉ โ
โ ูุฑุณู ุฅุดุนุงุฑ ูููุณุชูุจู โ
```

---

## ๐ ููุงุญุธุงุช ุฃูููุฉ:

### ูุง ุชู ุชุฎูููู:
- โ ูู ูุนุฏ ูููุน ูุฑุงุกุฉ ุจูุงูุงุช ุงููุณุชุฎุฏููู ุงูุฃุณุงุณูุฉ

### ููุงุฐุง ูุฐุง ุขูู:
1. โ ููุท ุงููุนูููุงุช **ุบูุฑ ุงูุญุณุงุณุฉ** ูุชุงุญุฉ
2. โ **ูุง ูููู** ูููุณุชุฎุฏููู ุบูุฑ ุงููุณุฌููู ุงููุฑุงุกุฉ
3. โ **ูุง ูููู** ูููุณุชุฎุฏููู ุงููุญุธูุฑูู ุงููุฑุงุกุฉ
4. โ ุงูุจูุงูุงุช ุงูุญุณุงุณุฉ (ูุซู ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ุงูุฎุงุต) **ููุณุช ูู ุงูุงุณุชุนูุงู**
5. โ ูุญุชุงุฌ ูุฐุง **ุจุงูุถุฑูุฑุฉ** ููุธุงู ุงูุดุงุช ูุฅุฏุงุฑุฉ ุงููุฑูู

### ุงูุจูุงูุงุช ุงููุชุงุญุฉ:
- โ ุงูุงุณู ุงููุงูู (`displayName`)
- โ ุงูุฏูุฑ (`role`)
- โ ุงููุณู (`department`)
- โ ุฑุฆูุณ ูุณูุ (`isHead`)
- โ ูุดุทุ (`isActive`)

### ุงูุจูุงูุงุช ุงููุญููุฉ:
- ๐ ูุง ูููู ุชุนุฏูู ุงูุฏูุฑ ุฃู ุงููุณู ุฅูุง ูู CEO
- ๐ ูุง ูููู ุญุฐู ุงููุณุชุฎุฏููู ุฅูุง ูู CEO
- ๐ ุงููุนูููุงุช ุงูุญุณุงุณุฉ (ุฅู ูุฌุฏุช) ูุญููุฉ

---

## ๐ ุงูุฃุฏุงุก:

### ุงูุงุณุชุนูุงูุงุช ุงููุณุชุฎุฏูุฉ:

1. **ุฌูุจ ุงููุญุงุฏุซุงุช**:
   ```javascript
   where('participants', 'array-contains', userId)
   ```
   โ ูุญุณูู ุจู index

2. **ุฌูุจ ุงููุณุชุฎุฏููู**:
   ```javascript
   where('isActive', '==', true)
   ```
   โ ูุญุณูู ุจู index

3. **ุฌูุจ ุงูุฑุณุงุฆู**:
   ```javascript
   orderBy('createdAt', 'asc')
   ```
   โ ูุญุณูู ุจู index

---

## ๐ ุงููุชูุฌุฉ ุงูููุงุฆูุฉ:

### โ ูุธุงู ุงูุดุงุช ูุนูู ุจุงููุงูู:
- โ ุนุฑุถ ูุงุฆูุฉ ุงููุญุงุฏุซุงุช
- โ ุฅูุดุงุก ูุญุงุฏุซุงุช ุฌุฏูุฏุฉ
- โ ุฅุฑุณุงู ุฑุณุงุฆู
- โ ุงุณุชูุจุงู ุฑุณุงุฆู ููุฑูุงู
- โ ุนุฏุฏ ุงูุฑุณุงุฆู ุบูุฑ ุงูููุฑูุกุฉ
- โ ุฅุดุนุงุฑุงุช ุชููุงุฆูุฉ
- โ ุฃูุงู ูุงูู ูุตูุงุญูุงุช ุตุงุฑูุฉ

---

## ๐ ุฌุฑุจ ุงูุขู!

ุงูุชุญ:
```
http://localhost:3000/chat
```

ูุงุณุชูุชุน ุจูุธุงู ุงูุดุงุช ุงููุฑูู ุงููุงูู! ๐ฌโจ

</div>


