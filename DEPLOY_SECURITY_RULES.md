# Ù†Ø´Ø± Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø£Ù…Ø§Ù† Ø§Ù„Ù…Ø­Ø¯Ø«Ø© ðŸ”’

<div dir="rtl">

**ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ­Ø¯ÙŠØ«**: 6 Ù†ÙˆÙÙ…Ø¨Ø± 2025  
**Ø§Ù„Ø£Ù‡Ù…ÙŠØ©**: ðŸ”´ Ø­Ø±Ø¬ - ÙŠØ¬Ø¨ Ù†Ø´Ø±Ù‡ ÙÙˆØ±Ø§Ù‹

---

## âœ… Ù…Ø§ ØªÙ… Ø¥ØµÙ„Ø§Ø­Ù‡

### 1. Ø«ØºØ±Ø© Ø£Ù…Ø§Ù† ÙÙŠ Orders Collection
**Ø§Ù„Ù…Ø´ÙƒÙ„Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©:**
```javascript
allow update: if isActiveUser();  // âŒ Ø£ÙŠ Ù…Ø³ØªØ®Ø¯Ù… ÙŠÙ…ÙƒÙ†Ù‡ ØªØ­Ø¯ÙŠØ« Ø£ÙŠ Ø·Ù„Ø¨!
```

**Ø§Ù„Ø­Ù„ Ø§Ù„Ù…Ø·Ø¨Ù‚:**
```javascript
allow update: if isActiveUser() && (
  isCEO() ||               // CEO: ØªØ­Ø¯ÙŠØ« Ø£ÙŠ Ø·Ù„Ø¨
  isHead() ||              // Ø±Ø¤Ø³Ø§Ø¡ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…: ØªØ­Ø¯ÙŠØ« Ø£ÙŠ Ø·Ù„Ø¨
  // ... ØµÙ„Ø§Ø­ÙŠØ§Øª Ù…Ø­Ø¯Ø¯Ø© Ù„ÙƒÙ„ Ù‚Ø³Ù… Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ù„Ø© ÙˆØ§Ù„Ø­Ù‚ÙˆÙ„
);
```

**Ø§Ù„ÙÙˆØ§Ø¦Ø¯:**
- âœ… ÙƒÙ„ Ù‚Ø³Ù… ÙŠÙ…ÙƒÙ†Ù‡ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø·Ù„Ø¨Ø§Øª ÙÙŠ Ù…Ø±Ø§Ø­Ù„Ù‡ ÙÙ‚Ø·
- âœ… ÙƒÙ„ Ù‚Ø³Ù… ÙŠÙ…ÙƒÙ†Ù‡ ØªØ­Ø¯ÙŠØ« Ø­Ù‚ÙˆÙ„ Ù…Ø¹ÙŠÙ†Ø© ÙÙ‚Ø·
- âœ… Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª ÙŠÙ…ÙƒÙ†Ù‡ ØªØ­Ø¯ÙŠØ« Ø·Ù„Ø¨Ø§ØªÙ‡ ÙÙ‚Ø· (ÙÙŠ Ø­Ø§Ù„Ø§Øª draft Ùˆ returned_to_sales)
- âœ… Ø£Ù…Ø§Ù† Ø£ÙØ¶Ù„ Ø¨ÙƒØ«ÙŠØ±

---

### 2. Ø«ØºØ±Ø© Ø£Ù…Ø§Ù† ÙÙŠ Counters Collection
**Ø§Ù„Ù…Ø´ÙƒÙ„Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©:**
```javascript
allow write: if isSignedIn();  // âŒ Ø£ÙŠ Ù…Ø³ØªØ®Ø¯Ù… ÙŠÙ…ÙƒÙ†Ù‡ ØªØºÙŠÙŠØ± Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª!
```

**Ø§Ù„Ø­Ù„ Ø§Ù„Ù…Ø·Ø¨Ù‚:**
```javascript
allow write: if false;  // âœ… ÙÙ‚Ø· Ø¹Ø¨Ø± Cloud Functions
```

**Ø§Ù„ÙÙˆØ§Ø¦Ø¯:**
- âœ… Ù„Ø§ Ø£Ø­Ø¯ ÙŠÙ…ÙƒÙ†Ù‡ ØªØºÙŠÙŠØ± Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…Ø¨Ø§Ø´Ø±Ø©
- âœ… ÙÙ‚Ø· Cloud Functions ÙŠÙ…ÙƒÙ†Ù‡Ø§ Ø°Ù„Ùƒ (Ø£ÙƒØ«Ø± Ø£Ù…Ø§Ù†Ø§Ù‹)
- âœ… Ø¶Ù…Ø§Ù† ØªØ³Ù„Ø³Ù„ Ø§Ù„Ø£Ø±Ù‚Ø§Ù…

---

## ðŸš€ Ø®Ø·ÙˆØ§Øª Ø§Ù„Ù†Ø´Ø±

### Ø§Ù„Ø®Ø·ÙˆØ© 1: Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„

```bash
# ØªØ£ÙƒØ¯ Ø£Ù†Ùƒ Ù…Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ Ù„Ù€ Firebase
firebase login

# ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø§Ù„Ø­Ø§Ù„ÙŠ
firebase projects:list
```

---

### Ø§Ù„Ø®Ø·ÙˆØ© 2: Ù†Ø´Ø± Ù‚ÙˆØ§Ø¹Ø¯ Firestore ÙÙ‚Ø·

```bash
# Ù…Ù† Ø¬Ø°Ø± Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ (D:\najd)
firebase deploy --only firestore:rules
```

**Ø§Ù„Ø®Ø±Ø¬ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹:**
```
=== Deploying to 'najd-xxxx'...

i  deploying firestore
i  firestore: checking firestore.rules for compilation errors...
âœ”  firestore: rules file firestore.rules compiled successfully
i  firestore: uploading rules firestore.rules...
âœ”  firestore: released rules firestore.rules to cloud.firestore

âœ”  Deploy complete!
```

---

### Ø§Ù„Ø®Ø·ÙˆØ© 3: Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù†Ø´Ø±

1. **Ø§ÙØªØ­ Firebase Console:**
   - Ø§Ø°Ù‡Ø¨ Ø¥Ù„Ù‰: https://console.firebase.google.com/
   - Ø§Ø®ØªØ± Ø§Ù„Ù…Ø´Ø±ÙˆØ¹
   - Ø§Ø°Ù‡Ø¨ Ø¥Ù„Ù‰: Firestore Database > Rules

2. **ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯:**
   - ÙŠØ¬Ø¨ Ø£Ù† ØªØ±Ù‰ Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ù…Ø­Ø¯Ø«Ø©
   - ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø³Ø·Ø± Ø§Ù„Ø®Ø§Øµ Ø¨Ù€ Orders (allow update)
   - ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø³Ø·Ø± Ø§Ù„Ø®Ø§Øµ Ø¨Ù€ Counters (allow write)

---

## âš ï¸ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù…Ù‡Ù…Ø©

### 1. Ù„Ø§ ØªÙ†Ø´Ø± ÙƒÙ„ Ø´ÙŠØ¡ Ø¯ÙØ¹Ø© ÙˆØ§Ø­Ø¯Ø©
```bash
# âŒ Ù„Ø§ ØªÙØ¹Ù„ Ù‡Ø°Ø§ (Ø³ÙŠÙ†Ø´Ø± Functions, Hosting, Ø¥Ù„Ø®):
firebase deploy

# âœ… Ø§ÙØ¹Ù„ Ù‡Ø°Ø§ (ÙÙ‚Ø· Firestore Rules):
firebase deploy --only firestore:rules
```

---

### 2. Ø§Ø®ØªØ¨Ø§Ø± Ù…Ø­Ù„ÙŠ Ø£ÙˆÙ„Ø§Ù‹ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)

```bash
# Ø´ØºÙ„ Firebase Emulators
firebase emulators:start

# Ø§ÙØªØ­: http://localhost:4000
# Ø§Ø°Ù‡Ø¨ Ù„Ù€ Firestore Emulator
# Ø§Ø®ØªØ¨Ø± Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
```

---

### 3. Rollback Ø¥Ø°Ø§ Ø­Ø¯Ø«Øª Ù…Ø´ÙƒÙ„Ø©

Ø¥Ø°Ø§ ÙˆØ§Ø¬Ù‡Øª Ù…Ø´ÙƒÙ„Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ù†Ø´Ø±:

```bash
# Ø§Ø­ÙØ¸ Ù†Ø³Ø®Ø© Ù…Ù† Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© Ø£ÙˆÙ„Ø§Ù‹
cp firestore.rules firestore.rules.backup

# Ø«Ù… ÙÙŠ Firebase Console:
# Firestore Database > Rules > Restore Ù…Ù† Ø§Ù„ØªØ§Ø±ÙŠØ®
```

---

## ðŸ§ª Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯ Ø¨Ø¹Ø¯ Ø§Ù„Ù†Ø´Ø±

### Ø§Ø®ØªØ¨Ø§Ø± 1: Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ù„Ø§ ÙŠÙ…ÙƒÙ†Ù‡ ØªØ­Ø¯ÙŠØ« Ø·Ù„Ø¨ ØºÙŠØ±Ù‡

```typescript
// ÙƒÙ€ Sales User
const otherUserOrder = await getDoc(doc(db, 'orders', 'order123'));

try {
  await updateDoc(doc(db, 'orders', 'order123'), {
    status: 'approved'
  });
  console.log('âŒ Ø®Ø·Ø£: ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙØ´Ù„!');
} catch (error) {
  console.log('âœ… ØµØ­ÙŠØ­: ØªÙ… Ù…Ù†Ø¹ Ø§Ù„ØªØ­Ø¯ÙŠØ«');
}
```

---

### Ø§Ø®ØªØ¨Ø§Ø± 2: Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¹Ø§Ø¯ÙŠ Ù„Ø§ ÙŠÙ…ÙƒÙ†Ù‡ ØªØºÙŠÙŠØ± Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª

```typescript
// ÙƒÙ€ Ø£ÙŠ Ù…Ø³ØªØ®Ø¯Ù…
try {
  await updateDoc(doc(db, 'counters', 'main'), {
    orders: 9999
  });
  console.log('âŒ Ø®Ø·Ø£: ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙØ´Ù„!');
} catch (error) {
  console.log('âœ… ØµØ­ÙŠØ­: ØªÙ… Ù…Ù†Ø¹ Ø§Ù„ØªØ­Ø¯ÙŠØ«');
}
```

---

### Ø§Ø®ØªØ¨Ø§Ø± 3: Ø§Ù„ØªØµÙ…ÙŠÙ… ÙŠÙ…ÙƒÙ†Ù‡ ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„ØªØµÙ…ÙŠÙ… ÙÙ‚Ø·

```typescript
// ÙƒÙ€ Design User
const designOrder = await getDoc(doc(db, 'orders', 'order456'));

// âœ… ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙ†Ø¬Ø­
await updateDoc(doc(db, 'orders', 'order456'), {
  status: 'in_design',
  updatedAt: serverTimestamp()
});

// âŒ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙØ´Ù„ (Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø§Ù„ÙŠØ©)
try {
  await updateDoc(doc(db, 'orders', 'order456'), {
    finalCost: 5000
  });
  console.log('âŒ Ø®Ø·Ø£: ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙØ´Ù„!');
} catch (error) {
  console.log('âœ… ØµØ­ÙŠØ­: ØªÙ… Ù…Ù†Ø¹ Ø§Ù„ØªØ­Ø¯ÙŠØ«');
}
```

---

## ðŸ“ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ©

### Orders Collection - allow update

**Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©:**

1. **CEO**: âœ… ØªØ­Ø¯ÙŠØ« Ø£ÙŠ Ø·Ù„Ø¨
2. **Heads**: âœ… ØªØ­Ø¯ÙŠØ« Ø£ÙŠ Ø·Ù„Ø¨
3. **Sales**: 
   - âœ… ØªØ­Ø¯ÙŠØ« Ø·Ù„Ø¨Ø§ØªÙ‡ ÙÙ‚Ø·
   - âœ… ÙÙŠ Ø­Ø§Ù„Ø§Øª: draft, returned_to_sales
   - âœ… Ø­Ù‚ÙˆÙ„ Ù…Ø­Ø¯Ø¯Ø©: Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„ØŒ Ø§Ù„Ù…Ù†ØªØ¬ØŒ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§ØªØŒ Ø¥Ù„Ø®
4. **Design**: 
   - âœ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø·Ù„Ø¨Ø§Øª ÙÙŠ Ù…Ø±Ø§Ø­Ù„ Ø§Ù„ØªØµÙ…ÙŠÙ…
   - âœ… Ø­Ù‚ÙˆÙ„ Ù…Ø­Ø¯Ø¯Ø©: status, assignedToDesign, designDescription, timeline, comments
5. **Printing**: 
   - âœ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø·Ù„Ø¨Ø§Øª ÙÙŠ Ù…Ø±Ø§Ø­Ù„ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©
   - âœ… Ø­Ù‚ÙˆÙ„ Ù…Ø­Ø¯Ø¯Ø©: status, assignedToPrinting, timeline, comments
6. **Accounting**: 
   - âœ… ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ³Ø¹ÙŠØ±Ø© ÙˆØ§Ù„Ø¯ÙØ¹Ø§Øª
   - âœ… Ø­Ù‚ÙˆÙ„ Ù…Ø­Ø¯Ø¯Ø©: Ø§Ù„ØªØ³Ø¹ÙŠØ±Ø©ØŒ Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§ØªØŒ Ø§Ù„Ø­Ø§Ù„Ø©
7. **Dispatch**: 
   - âœ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ÙˆØ§Ø¯ ÙˆØ§Ù„Ø¥Ø±Ø³Ø§Ù„
   - âœ… Ø­Ù‚ÙˆÙ„ Ù…Ø­Ø¯Ø¯Ø©: status, materialsStatus, ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ù„ÙŠÙ…

---

### Counters Collection - allow write

**Ø§Ù„ØªØºÙŠÙŠØ±:**
- Ù…Ù†: `allow write: if isSignedIn();`
- Ø¥Ù„Ù‰: `allow write: if false;`

**Ø§Ù„Ø³Ø¨Ø¨:**
- Ø£ÙƒØ«Ø± Ø£Ù…Ø§Ù†Ø§Ù‹
- ÙÙ‚Ø· Cloud Functions ÙŠÙ…ÙƒÙ†Ù‡Ø§ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª
- Ø¶Ù…Ø§Ù† ØªØ³Ù„Ø³Ù„ Ø§Ù„Ø£Ø±Ù‚Ø§Ù…

---

## ðŸ”’ Ø§Ù„Ø£Ù…Ø§Ù† Ø¨Ø¹Ø¯ Ø§Ù„ØªØ­Ø¯ÙŠØ«

### Ù‚Ø¨Ù„ Ø§Ù„ØªØ­Ø¯ÙŠØ«:
- âš ï¸ **Ø®Ø·Ø± Ø£Ù…Ù†ÙŠ**: Ø£ÙŠ Ù…Ø³ØªØ®Ø¯Ù… ÙŠÙ…ÙƒÙ†Ù‡ ØªØ­Ø¯ÙŠØ« Ø£ÙŠ Ø·Ù„Ø¨
- âš ï¸ **Ø®Ø·Ø± Ø£Ù…Ù†ÙŠ**: Ø£ÙŠ Ù…Ø³ØªØ®Ø¯Ù… ÙŠÙ…ÙƒÙ†Ù‡ ØªØºÙŠÙŠØ± Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª
- ðŸ”´ **Ø§Ù„ØªÙ‚ÙŠÙŠÙ…**: 60/100

### Ø¨Ø¹Ø¯ Ø§Ù„ØªØ­Ø¯ÙŠØ«:
- âœ… **Ø¢Ù…Ù†**: ÙƒÙ„ Ù‚Ø³Ù… ÙŠØ­Ø¯Ø« Ù…Ø§ ÙŠØ®ØµÙ‡ ÙÙ‚Ø·
- âœ… **Ø¢Ù…Ù†**: Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…Ø­Ù…ÙŠØ©
- âœ… **Ø¢Ù…Ù†**: Ø­Ù‚ÙˆÙ„ Ù…Ø­Ø¯Ø¯Ø© Ù„ÙƒÙ„ Ø¯ÙˆØ±
- ðŸŸ¢ **Ø§Ù„ØªÙ‚ÙŠÙŠÙ…**: 90/100

---

## âœ… Checklist

Ù‚Ø¨Ù„ Ø§Ù„Ù†Ø´Ø±:
- [x] ØªÙ… ØªØ­Ø¯ÙŠØ« firestore.rules
- [x] ØªÙ… Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª
- [x] ØªÙ… ÙÙ‡Ù… Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
- [ ] ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù€ Firebase
- [ ] ØªÙ… Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø§Ù„ØµØ­ÙŠØ­

Ø¨Ø¹Ø¯ Ø§Ù„Ù†Ø´Ø±:
- [ ] ØªÙ… Ù†Ø´Ø± Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯ Ø¨Ù†Ø¬Ø§Ø­
- [ ] ØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Firebase Console
- [ ] ØªÙ… Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª
- [ ] Ø§Ù„Ù†Ø¸Ø§Ù… ÙŠØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­

---

## ðŸ“ž Ø¥Ø°Ø§ ÙˆØ§Ø¬Ù‡Øª Ù…Ø´ÙƒÙ„Ø©

1. **ØªØ­Ù‚Ù‚ Ù…Ù† Firebase Console** - Ù‡Ù„ Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯ Ù…Ù†Ø´ÙˆØ±Ø©ØŸ
2. **Ø±Ø§Ø¬Ø¹ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡** - Firebase Console > Firestore > Rules > Errors
3. **Ø§Ø®ØªØ¨Ø± Ù…Ø­Ù„ÙŠØ§Ù‹** - Ø§Ø³ØªØ®Ø¯Ù… Emulators
4. **Rollback** - Ø§Ø³ØªØ±Ø¬Ø¹ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© Ø¥Ø°Ø§ Ù„Ø²Ù… Ø§Ù„Ø£Ù…Ø±

---

**Ø§Ù„Ø­Ø§Ù„Ø©**: âœ… Ø¬Ø§Ù‡Ø² Ù„Ù„Ù†Ø´Ø±  
**Ø§Ù„Ø£Ù‡Ù…ÙŠØ©**: ðŸ”´ Ø­Ø±Ø¬  
**Ø§Ù„Ù…Ø¯Ø©**: 5 Ø¯Ù‚Ø§Ø¦Ù‚

</div>



